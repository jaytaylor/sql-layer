{

"setup" : {
    "processors_default" : [ "scanrows" ],
    "schema" : "coi",
    "tables" : [
        [ "customer",
            "cid int not null primary key",
            "name varchar(32)"
        ],

        [ "orders",
            "oid int not null primary key",
            "c_id int",
            "when varchar(10)",
            "GROUPING FOREIGN KEY (c_id) REFERENCES customer(cid)"
        ]
    ],
    "write_rows" : {
        "customer"  : [ [11, "Alpha"],
                        [12, "Bravo"],
                        [13, "Charlie"],
                        [14, "Delta"],
                        [15, "Echo"],
                        [16, "Foxtrot"]
        ],
        "orders"    : [ [21, 11, "1/1/2001"],
                        [22, 11, "2/2/2002"],
                        [23, 12, "3/3/2003"],
                        [24, 12, "3/3/2003"],
                        [25, 12, "3/3/2003"],
                        [26, 16, "4/4/2004"]
        ]
    }
},

"tests" : {
    "no customers" : {
        "get"           : "coi:customer:(:LIMIT=0)cid>0",
        "expect result" :
        {
            "@customer" : []
        }
    },

    "no orders" : {
        "get"           : "coi:customer:(orders:LIMIT=0)oid>0",
        "expect result" :
        {
            "@customer" : []
        }
    },

    "one customer" : {
        "get"           : "coi:customer:(:LIMIT=1)cid>0",
        "expect result" :
        {
            "@customer" : [
                {
                    "cid"   : 11,
                    "name"  : "Alpha",
                    "@orders" : [
                        {
                            "oid"  : 21,
                            "c_id" : 11,
                            "when" : "1/1/2001"
                        },
                        {
                            "oid"  : 22,
                            "c_id" : 11,
                            "when" : "2/2/2002"
                        }
                    ]
                }
            ]
        }
    },

    "three orders" : {
        "get"           : "coi:customer:(orders:LIMIT=3)oid>0",
        "expect result" :
        {
            "@customer" : [
                {
                    "cid"   : 11,
                    "name"  : "Alpha",
                    "@orders" : [
                        {
                            "oid"  : 21,
                            "c_id" : 11,
                            "when" : "1/1/2001"
                        }
                    ]
                },
                {
                    "cid"   : 11,
                    "name"  : "Alpha",
                    "@orders" : [
                        {
                            "oid"  : 22,
                            "c_id" : 11,
                            "when" : "2/2/2002"
                        }
                    ]
                },
                {
                    "cid" : 12,
                    "name" : "Bravo",
                    "@orders" : [
                        {
                            "oid"  : 23,
                            "c_id" : 12,
                            "when" : "3/3/2003"
                        }

                    ]
                }
            ]
        }
    }
}

}
