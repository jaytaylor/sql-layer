{
"comment" : ["See spec file: ",
    "https://spreadsheets.google.com/a/akiban.com/ccc?key=0AiGr_XWdHm0edFNSaFZwUXd5SnAtOHlDcTJyOEUzdXc",
    "This test plan has a couple modifications from that spec:",
    "   - no orphan rows",
    "   - giving customer id=9 an address"
],

"setup" : {
    "processors_default" : [ "scanrows" ],
    "schema" : "coi",
    "tables" : [
        [ "customer",
            "cid int not null primary key",
            "name varchar(32)",
            "status int",
            "index(status)"
        ],

        [ "orders",
            "oid int not null primary key",
            "c_id int",
            "when varchar(10)",
            "GROUPING FOREIGN KEY (c_id) REFERENCES customer(cid)"
        ]
    ],
    "write_rows" : {
        "customer"  : [ [11, "Alpha", 1],
                        [12, "Bravo", 1],
                        [13, "Charlie", 2],
                        [14, "Delta", 2],
                        [15, "Echo", 3],
                        [16, "Foxtrot", 3]
        ],
        "orders"    : [ [21, 11, "1/1/2001"],
                        [22, 11, "2/2/2002"],
                        [23, 12, "3/3/2003"],
                        [24, 16, "4/4/2004"]
        ]
    }
},

"tests" : {
    "with orders" : {
        "get"           : "coi:customer:status=1",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 11,
                    "name" : "Alpha",
                    "status" : 1,
                    "@orders" :
                    [
                        {
                            "oid" : 21,
                            "c_id" : 11,
                            "when" : "1/1/2001"
                        },
                        {
                            "oid" : 22,
                            "c_id" : 11,
                            "when" : "2/2/2002"
                        }
                    ]
                },
                {
                    "cid" : 12,
                    "name" : "Bravo",
                    "status" : 1,
                    "@orders" :
                    [
                        {
                            "oid" : 23,
                            "c_id" : 12,
                            "when" : "3/3/2003"
                        }
                    ]
                }
            ]
        }
    },

    "no orders" :
    {
        "get"           : "coi:customer:status=2",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 13,
                    "name" : "Charlie",
                    "status" : 2,
                    "@orders" : []
                },
                {
                    "cid" : 14,
                    "name" : "Delta",
                    "status" : 2,
                    "@orders" : []
                }
            ]
        }
    },


    "one has orders" : {
        "get"           : "coi:customer:status=3",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 15,
                    "name" : "Echo",
                    "status" : 3,
                    "@orders" : []
                },
                {
                    "cid" : 16,
                    "name" : "Foxtrot",
                    "status" : 3,
                    "@orders" :
                    [
                        {
                            "oid" : 24,
                            "c_id" : 16,
                            "when" : "4/4/2004"
                        }
                    ]
                }
            ]
        }
    }
}

}
