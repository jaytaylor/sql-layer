{
"comment" : ["See spec file: ",
    "https://spreadsheets.google.com/a/akiban.com/ccc?key=0AiGr_XWdHm0edFNSaFZwUXd5SnAtOHlDcTJyOEUzdXc",
    "Each row has 0-1 children. The structure under each customer is determined by id values.",
    "Id uses four bits as follow:",
    "- bit 0 (LSB): 1 if customer is present, 0 if not",
    "- bit 1:       1 if order is present, 0 if not",
    "- bit 2:       1 if item is present, 0 if not",
    "- bit 3 (MSB): 1 if address is present, 0 if not"
],

"setup" : {
    "processors_default" : [ "scanrows" ],
    "schema" : "coia",
    "tables" : [
        [ "customer",
            "cid int not null",
            "cid_copy int not null",
            "primary key(cid)",
            "index(cid_copy)"
        ],

        [ "orders",
            "cid int not null",
            "oid int not null",
            "primary key(cid, oid)",
            "GROUPING FOREIGN KEY (cid) REFERENCES customer(cid)"
        ],

        [ "item",
            "cid int not null",
            "oid int not null",
            "iid int not null",
            "primary key(cid, oid, iid)",
            "GROUPING FOREIGN KEY (cid, oid) REFERENCES orders(cid, oid)"
        ],

        [ "address",
            "cid int not null",
            "aid int not null",
            "primary key(cid, aid)",
            "GROUPING FOREIGN KEY (cid) REFERENCES customer(cid)"
        ]
    ],
    "write_rows" : {
        "customer" : [
            [1, 1],
            [3, 3],
            [5, 5],
            [7, 7],
            [9, 9],
            [11, 11],
            [13, 13],
            [15, 15]
        ],
        "orders" : [
            [2, 2],
            [3, 3],
            [6, 6],
            [7, 7],
            [10, 10],
            [11, 11],
            [14, 14],
            [15, 15]
        ],
        "item" : [
            [4, 4, 4],
            [5, 5, 5],
            [6, 6, 6],
            [7, 7, 7],
            [12, 12, 12],
            [13, 13, 13],
            [14, 14, 14],
            [15, 15, 15]
        ],
        "address" : [
            [8, 8],
            [9, 9],
            [10, 10],
            [11, 11],
            [12, 12],
            [13, 13],
            [14, 14],
            [15, 15]
        ]
    }
},

"tests" : {
    "orphan:coia" : {
        "get" : "coia:customer:cid_copy=15",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 15,
                    "cid_copy" : 15,
                    "@orders" :
                    [
                        {
                            "cid" : 15,
                            "oid" : 15,
                            "@item" :
                            [
                                {
                                    "cid" : 15,
                                    "oid" : 15,
                                    "iid" : 15
                                }
                            ]
                        }
                    ],
                    "@address" :
                    [
                        {
                            "cid" : 15,
                            "aid" : 15
                        }
                    ]
                }
            ]
        }
    },
    "orphan:_oia" : {
        "get" : "coia:customer:cid_copy=14",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:c_ia" : {
        "get" : "coia:customer:cid_copy=13",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 13,
                    "cid_copy" : 13,
                    "@orders" :
                    [
                        {
                            "cid" : null,
                            "oid" : null,
                            "@item" :
                            [
                                {
                                    "cid" : 13,
                                    "oid" : 13,
                                    "iid" : 13
                                }
                            ]
                        }
                    ],
                    "@address" :
                    [
                        {
                            "cid" : 13,
                            "aid" : 13
                        }
                    ]
                }
            ]
        }
    },
    "orphan:__ia" : {
        "get" : "coia:customer:cid_copy=12",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:co_a" : {
        "get" : "coia:customer:cid_copy=11",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 11,
                    "cid_copy" : 11,
                    "@orders" :
                    [
                        {
                            "cid" : 11,
                            "oid" : 11,
                            "@item" : []
                        }
                    ],
                    "@address" :
                    [
                        {
                            "cid" : 11,
                            "aid" : 11
                        }
                    ]
                }
            ]
        }
    },
    "orphan:_o_a" : {
        "get" : "coia:customer:cid_copy=10",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:c__a" : {
        "get" : "coia:customer:cid_copy=9",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 9,
                    "cid_copy" : 9,
                    "@orders" : [],
                    "@address" :
                    [
                        {
                            "cid" : 9,
                            "aid" : 9
                        }
                    ]
                }
            ]
        }
    },
    "orphan:___a" : {
        "get" : "coia:customer:cid_copy=8",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:coi_" : {
        "get" : "coia:customer:cid_copy=7",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 7,
                    "cid_copy" : 7,
                    "@orders" :
                    [
                        {
                            "cid" : 7,
                            "oid" : 7,
                            "@item" :
                            [
                                {
                                    "cid" : 7,
                                    "oid" : 7,
                                    "iid" : 7
                                }
                            ]
                        }
                    ],
                    "@address" : []
                }
            ]
        }
    },
    "orphan:_oi_" : {
        "get" : "coia:customer:cid_copy=6",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:c_i_" : {
        "get" : "coia:customer:cid_copy=5",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 5,
                    "cid_copy" : 5,
                    "@orders" :
                    [
                        {
                            "cid" : null,
                            "oid" : null,
                            "@item" :
                            [
                                {
                                    "cid" : 5,
                                    "oid" : 5,
                                    "iid" : 5
                                }
                            ]
                        }
                    ],
                    "@address" : []
                }
            ]
        }
    },
    "orphan:__i_" : {
        "get" : "coia:customer:cid_copy=4",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:co__" : {
        "get" : "coia:customer:cid_copy=3",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 3,
                    "cid_copy" : 3,
                    "@orders" :
                    [
                        {
                            "cid" : 3,
                            "oid" : 3,
                            "@item" : []
                        }
                    ],
                    "@address" : []
                }
            ]
        }
    },
    "orphan:_o__" : {
        "get" : "coia:customer:cid_copy=2",
        "expect result" :
        {
            "@customer" : []
        }
    },
    "orphan:c___" : {
        "get" : "coia:customer:cid_copy=1",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 1,
                    "cid_copy" : 1,
                    "@orders" : [],
                    "@address" : []
                }
            ]
        }
    },
    "orphan:____" : {
        "get" : "coia:customer:cid=0",
        "expect result" :
        {
            "@customer" : []
        }
    }
}

}
